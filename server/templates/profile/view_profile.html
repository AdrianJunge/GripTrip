{% extends "base.html" %}


{% block head %}
    <title>Profile of {{ user.username }} - {{ app_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='profile/profile.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='trip/trips.css') }}">
{% endblock %}

{% block content %}
<div class="profile-container">
    <section class="profile-section">

        <div class="profile-top">
            <div class="profile-basic-info">
                <div class="profile-avatar">{{ user.avatar }}</div>
                
                <div class="profile-name">
                    <h3>{{ user.username }}</h3>
                    <div class="profile-username">@{{ user.username }}</div>
                </div>
            </div>

            <div class="profile-bio">
                {% if not user.bio %}
                    <em>No bio available.</em>
                {% else %}
                    {{ user.bio }}
                {% endif %}
            </div>
        </div>    

        {% if user.id == current_user.id %}
        <div class="profile-stats">
            <div class="stat">
                <span class="stat-label">Following: </span>
                <span class="stat-number">{{ user.following | length }}</span>
            </div>
            <div class="stat">
                <span class="stat-label">Followers: </span>
                <span class="stat-number">{{ user.followers | length }}</span>
            </div>
        </div>
        {% endif %}

        <div class="profile-actions">
            <a href="/" class="btn btn-outline-secondary">‚Üê Home</a>
            {% if user.id != current_user.id %}
                {% if current_user.is_following(user) %}
                    <form action="{{ url_for('profile.unfollow', user_id=user.id) }}" method="post">
                        <button type="submit" class="btn btn-primary">Unfollow</button>
                    </form>
                {% else %}
                    <form action="{{ url_for('profile.follow', user_id=user.id) }}" method="post">
                        <button type="submit" class="btn btn-primary">Follow</button>
                    </form>
                {% endif %}
            {% else %}
                <a class="btn btn-primary" href="{{ url_for('profile.edit_profile') }}">Edit Profile</a>
            {% endif %}
        </div>
    </section>

    {% macro trip_section(title, trips, empty_text) %}
        <h2 class="section-title">{{ title }}</h2>
        {% if trips | length == 0 %}
            <em>{{ empty_text }}</em>
        {% else %}
            <div class="container">
            <div class="trips-grid">
                {% for trip in trips %}
                {% include 'trip/trip_card.html' with context %}
                {% endfor %}
            </div>
            </div>
        {% endif %}
    {% endmacro %}

    <section class="posts-section">
        {% set display_name = 'you' if current_user.id == user.id else user.username %}

        {{ trip_section("Trips created by " ~ display_name, user.proposals, "No trips proposed yet.") }}
        {{ trip_section("Other trips joined by " ~ display_name, trips_joined, "No trips joined yet.") }}
    </section>
</div>
{% endblock %}
